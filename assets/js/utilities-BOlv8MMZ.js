var e=Object.defineProperty,t=(t,n,r)=>((t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r)(t,"symbol"!=typeof n?n+"":n,r);import{X as n}from"./misc-vendor-BJFfAKB9.js";import{c as r,C as s}from"./crypto-vendor-C24J1brN.js";const a={},o=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),s=n?.nonce||n?.getAttribute("nonce");r=e(t.map(e=>{if((e=function(e){return"/"+e}(e))in a)return;a[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script"),r.crossOrigin="",r.href=e,s&&r.setAttribute("nonce",s),document.head.appendChild(r),t?new Promise((t,n)=>{r.addEventListener("load",t),r.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)})},i="TableTech-2024-SecureKey-Default";var c=(e=>(e.NECESSARY="necessary",e.FUNCTIONAL="functional",e.ANALYTICS="analytics",e.MARKETING="marketing",e.PERFORMANCE="performance",e))(c||{});const l=[{name:"tabletech_session",category:"necessary",provider:"TableTech",purpose:"Maintains user session during website visit",duration:"Session",type:"first-party",encrypted:!0},{name:"csrf_token",category:"necessary",provider:"TableTech",purpose:"Protects against Cross-Site Request Forgery attacks",duration:"Session",type:"first-party",encrypted:!0},{name:"cookieconsent_status",category:"necessary",provider:"TableTech",purpose:"Stores cookie consent preferences",duration:"12 months",type:"first-party"},{name:"i18nextLng",category:"functional",provider:"TableTech",purpose:"Stores language preference (NL/EN)",duration:"12 months",type:"first-party"},{name:"timezone",category:"functional",provider:"TableTech",purpose:"Stores user timezone for correct time display",duration:"30 days",type:"first-party"},{name:"form_data_temp",category:"functional",provider:"TableTech",purpose:"Temporarily stores form data to prevent data loss",duration:"Session",type:"first-party",encrypted:!0},{name:"_ga",category:"analytics",provider:"Google Analytics",purpose:"Distinguishes unique users",duration:"2 years",type:"first-party"},{name:"_gid",category:"analytics",provider:"Google Analytics",purpose:"Distinguishes unique users",duration:"24 hours",type:"first-party"},{name:"_gat_gtag_*",category:"analytics",provider:"Google Analytics",purpose:"Throttles request rate",duration:"1 minute",type:"first-party"},{name:"_ga_*",category:"analytics",provider:"Google Analytics 4",purpose:"Stores session state and campaign info",duration:"2 years",type:"first-party"},{name:"_fbp",category:"marketing",provider:"Facebook/Meta",purpose:"Facebook Pixel for ad tracking",duration:"3 months",type:"third-party"},{name:"IDE",category:"marketing",provider:"Google/Doubleclick",purpose:"Google Ads remarketing",duration:"13 months",type:"third-party"},{name:"__cf_bm",category:"performance",provider:"Cloudflare",purpose:"Bot management and security",duration:"30 minutes",type:"first-party"}],p=class e{constructor(){t(this,"consent",null),t(this,"CONSENT_COOKIE","cookieconsent_status"),t(this,"CONSENT_VERSION","1.0.0"),t(this,"SECURE_FLAGS",{secure:!0,sameSite:"strict",expires:365}),this.loadConsent(),this.initializeCSRF()}static getInstance(){return e.instance||(e.instance=new e),e.instance}initializeCSRF(){this.getCSRFToken()||this.generateCSRFToken()}generateCSRFToken(){const e=r.lib.WordArray.random(32).toString(),t=this.encrypt(e);return this.setCookie("csrf_token",t,{...this.SECURE_FLAGS,expires:void 0,sameSite:"strict"}),e}getCSRFToken(){const e=n.get("csrf_token");if(e)try{return this.decrypt(e)}catch{return null}return null}validateCSRFToken(e){const t=this.getCSRFToken();return null!==t&&t===e}encrypt(e){return r.AES.encrypt(e,i).toString()}decrypt(e){return r.AES.decrypt(e,i).toString(r.enc.Utf8)}loadConsent(){const e=n.get(this.CONSENT_COOKIE);if(e)try{this.consent=JSON.parse(e)}catch{this.consent=null}}saveConsent(e){this.consent={necessary:!0,functional:e.functional??!1,analytics:e.analytics??!1,marketing:e.marketing??!1,performance:e.performance??!1,timestamp:Date.now(),version:this.CONSENT_VERSION},n.set(this.CONSENT_COOKIE,JSON.stringify(this.consent),{...this.SECURE_FLAGS,expires:365}),this.applyConsent()}getConsent(){return this.consent}hasConsent(e){if(!this.consent)return"necessary"===e;switch(e){case"necessary":return!0;case"functional":return this.consent.functional;case"analytics":return this.consent.analytics;case"marketing":return this.consent.marketing;case"performance":return this.consent.performance;default:return!1}}applyConsent(){const e=n.get();l.forEach(t=>{this.hasConsent(t.category)||Object.keys(e).forEach(e=>{(e===t.name||t.name.includes("*")&&new RegExp(t.name.replace("*",".*")).test(e))&&(n.remove(e),n.remove(e,{path:"/"}),n.remove(e,{domain:".tabletech.nl"}))})}),this.hasConsent("analytics")?this.enableGoogleAnalytics():this.disableGoogleAnalytics(),this.hasConsent("marketing")||this.disableMarketingScripts()}enableGoogleAnalytics(){"undefined"!=typeof window&&window.gtag&&window.gtag("consent","update",{analytics_storage:"granted"})}disableGoogleAnalytics(){"undefined"!=typeof window&&(window["ga-disable-G-GV8ZVCHNFE"]=!0,window.gtag&&window.gtag("consent","update",{analytics_storage:"denied"}),["_ga","_gid","_gat","_gat_gtag_UA"].forEach(e=>{n.remove(e),n.remove(e,{path:"/"}),n.remove(e,{domain:".tabletech.nl"})}))}disableMarketingScripts(){"undefined"!=typeof window&&window.fbq&&(window.fbq=()=>{}),["_fbp","fr","IDE","test_cookie"].forEach(e=>{n.remove(e),n.remove(e,{path:"/"}),n.remove(e,{domain:".tabletech.nl"})})}setCookie(e,t,r,s){const a=l.find(t=>t.name===e);if(a&&!this.hasConsent(a.category))return;const o=s||a?.encrypted?this.encrypt(t):t;n.set(e,o,{...this.SECURE_FLAGS,...r})}getCookie(e,t){const r=l.find(t=>t.name===e),s=n.get(e);if(s){if(t||r?.encrypted)try{return this.decrypt(s)}catch{return}return s}}removeCookie(e){n.remove(e),n.remove(e,{path:"/"}),n.remove(e,{domain:".tabletech.nl"})}clearAllCookies(e=!0){const t=n.get();Object.keys(t).forEach(t=>{const n=l.find(e=>e.name===t||e.name.includes("*")&&new RegExp(e.name.replace("*",".*")).test(t));e&&n&&"necessary"===n.category||this.removeCookie(t)})}getCookiesByCategory(e){return l.filter(t=>t.category===e)}getAllCookieDefinitions(){return l}getActiveCookies(){return Object.keys(n.get())}generateSecureSession(){const e=r.lib.WordArray.random(32).toString(),t=this.encrypt(e);return this.setCookie("tabletech_session",t,{expires:void 0,sameSite:"strict",secure:!0}),e}validateSession(e){return this.getCookie("tabletech_session",!0)===e}updateConsentVersion(e){this.consent&&this.consent.version!==e&&(this.consent=null,this.removeCookie(this.CONSENT_COOKIE))}};t(p,"instance");const u=p.getInstance(),d=class e{constructor(){t(this,"CSP_NONCE_LENGTH",16),this.initializeSecurityHeaders()}static getInstance(){return e.instance||(e.instance=new e),e.instance}initializeSecurityHeaders(){"undefined"!=typeof window&&(this.setMetaTag("referrer","strict-origin-when-cross-origin"),this.ensureCSRFToken())}setMetaTag(e,t){let n=document.querySelector(`meta[name="${e}"]`);n||(n=document.createElement("meta"),n.name=e,document.head.appendChild(n)),n.content=t}generateNonce(){return s.lib.WordArray.random(this.CSP_NONCE_LENGTH).toString()}getCSPHeader(e){return["default-src 'self'",`script-src 'self' 'nonce-${e}' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com https://www.google-analytics.com https://challenges.cloudflare.com`,"style-src 'self' 'unsafe-inline'","img-src 'self' data: https: blob:","font-src 'self' data: https://r2cdn.perplexity.ai","connect-src 'self' https://www.google-analytics.com https://www.googletagmanager.com https://region1.google-analytics.com https://api.tabletech.nl https://tabletech.nl http://localhost:3002 ws://localhost:* wss://localhost:*","frame-src 'self' https://www.youtube.com https://player.vimeo.com https://challenges.cloudflare.com","base-uri 'self'","form-action 'self'","upgrade-insecure-requests","block-all-mixed-content"].join("; ")}sanitizeInput(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}validateEmail(e){return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e)&&e.length<=254}validatePhone(e){return/^(\+31|0031|0)[1-9][0-9]{8}$|^\+[1-9][0-9]{1,14}$/.test(e.replace(/[\s-]/g,""))}validateUrl(e){try{const t=new URL(e);return["http:","https:"].includes(t.protocol)}catch{return!1}}ensureCSRFToken(){let e=u.getCSRFToken();return e||(e=u.generateCSRFToken()),e}addCSRFToRequest(e){const t=this.ensureCSRFToken(),n=new Headers(e.headers||{});return n.set("X-CSRF-Token",t),{...e,headers:n,credentials:"same-origin"}}validateCSRFToken(e){return u.validateCSRFToken(e)}hashPassword(e,t){const n=t||s.lib.WordArray.random(16).toString();return`${n}:${s.PBKDF2(e,n,{keySize:8,iterations:1e4}).toString()}`}verifyPassword(e,t){const[n]=t.split(":");return this.hashPassword(e,n)===t}generateSecureRandomString(e=32){return s.lib.WordArray.random(e).toString()}encryptData(e,t){const n=JSON.stringify(e),r=t||"TableTech-Default-Key";return s.AES.encrypt(n,r).toString()}decryptData(e,t){try{const n=t||"TableTech-Default-Key",r=s.AES.decrypt(e,n).toString(s.enc.Utf8);return JSON.parse(r)}catch{return null}}rateLimit(e,t=5,n=9e5){const r=Date.now(),s=`rate_limit_${e}`,a=localStorage.getItem(s),o=a?JSON.parse(a):{attempts:[],blockedUntil:0};return!(o.blockedUntil>r||(o.attempts=o.attempts.filter(e=>r-e<n),o.attempts.length>=t?(o.blockedUntil=r+n,localStorage.setItem(s,JSON.stringify(o)),1):(o.attempts.push(r),localStorage.setItem(s,JSON.stringify(o)),0)))}clearRateLimit(e){localStorage.removeItem(`rate_limit_${e}`)}detectSuspiciousActivity(e){const t=JSON.stringify(e).toLowerCase();return[/<script[^>]*>.*?<\/script>/gi,/javascript:/gi,/on\w+\s*=/gi,/eval\(/gi,/document\.cookie/gi,/window\.location/gi,/<iframe/gi,/base64,/gi,/union.*select/gi,/drop.*table/gi,/insert.*into/gi,/select.*from/gi].some(e=>e.test(t))}sanitizeFormData(e){const t={};for(const[n,r]of Object.entries(e))"string"==typeof r?t[n]=this.sanitizeInput(r):"object"!=typeof r||null===r||Array.isArray(r)?t[n]=r:t[n]=this.sanitizeFormData(r);return t}generateSessionToken(){const e=this.generateSecureRandomString(32),t=Date.now();return`${e}:${t}:${s.HmacSHA256(`${e}:${t}`,"TableTech-Session-Secret").toString()}`}validateSessionToken(e){try{const[t,n,r]=e.split(":");if(r!==s.HmacSHA256(`${t}:${n}`,"TableTech-Session-Secret").toString())return!1;const a=parseInt(n);return Date.now()-a<864e5}catch{return!1}}getSecurityHeaders(){const e=this.generateNonce();return{"Content-Security-Policy":this.getCSPHeader(e),"X-Content-Type-Options":"nosniff","X-Frame-Options":"DENY","X-XSS-Protection":"1; mode=block","Referrer-Policy":"strict-origin-when-cross-origin","Permissions-Policy":"geolocation=(), microphone=(), camera=()","Strict-Transport-Security":"max-age=31536000; includeSubDomains; preload","X-Permitted-Cross-Domain-Policies":"none","X-Download-Options":"noopen","X-DNS-Prefetch-Control":"off","CSP-Nonce":e}}logSecurityEvent(e,t){const n={type:e,timestamp:(new Date).toISOString(),details:t,userAgent:navigator.userAgent,url:window.location.href},r=JSON.parse(localStorage.getItem("security_events")||"[]");r.push(n),r.length>100&&r.shift(),localStorage.setItem("security_events",JSON.stringify(r)),fetch("/api/security/log",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":this.ensureCSRFToken()},body:JSON.stringify(n)}).catch(()=>{})}};t(d,"instance");const g=d.getInstance(),m=()=>{const e="true"===sessionStorage.getItem("openCookieSettings");return e&&sessionStorage.removeItem("openCookieSettings"),e};function h(...e){return e.filter(Boolean).join(" ")}const y=()=>"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:3002/api":"https://tabletech.nl/api",f=async e=>{const t=y(),n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),r={restaurantName:e.restaurant||"Niet opgegeven",contactPerson:`${e.firstName} ${e.lastName}`.trim(),email:e.email,phone:e.phone,date:e.preferredDate,time:e.preferredTime,message:e.message||"Demo afspraak aangevraagd via website"};try{const e=await fetch(`${t}/v2/appointments`,{method:"POST",headers:{"Content-Type":"application/json","X-Idempotency-Key":n,"X-Client-Version":"2.0.0"},body:JSON.stringify(r)}),s=await e.json();return e.ok?{ok:s.success,requestId:s.referenceNumber||n,message:s.message||"Afspraak succesvol gemaakt"}:{ok:!0,requestId:n,message:"Afspraak geregistreerd (demo mode)"}}catch(s){return{ok:!0,requestId:n,message:"Afspraak geregistreerd (offline mode)"}}},S=async(e,t)=>{const n=y();try{const r=await fetch(`${n}/v2/appointments/available-dates?year=${e}&month=${t}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok){const n=new Date(e,t-1,0).getDate(),r=[];for(let s=1;s<=n;s++){const n=new Date(e,t-1,s),a=n.getDay();if(0===a||6===a)continue;const o=new Date;if(o.setHours(0,0,0,0),n<o)continue;const i=`${e}-${String(t).padStart(2,"0")}-${String(s).padStart(2,"0")}`;r.push(i)}return r}return(await r.json()).availableDates||[]}catch(r){return[]}},v=async e=>{const t=[{time:"09:00",isAvailable:!0},{time:"09:30",isAvailable:!0},{time:"10:00",isAvailable:!0},{time:"10:30",isAvailable:!0},{time:"11:00",isAvailable:!0},{time:"11:30",isAvailable:!0},{time:"13:00",isAvailable:!0},{time:"13:30",isAvailable:!0},{time:"14:00",isAvailable:!0},{time:"14:30",isAvailable:!0},{time:"15:00",isAvailable:!0},{time:"15:30",isAvailable:!0},{time:"16:00",isAvailable:!0},{time:"16:30",isAvailable:!0}],n=y();try{const r=await fetch(`${n}/v2/appointments/slots?date=${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)return t;const s=await r.json();return s.success&&s.slots?s.slots:t}catch(r){return t}};export{c as C,o as _,m as a,h as b,u as c,v as d,f as e,S as g,g as s};
