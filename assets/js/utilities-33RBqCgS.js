var x=Object.defineProperty;var O=(r,e,t)=>e in r?x(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var m=(r,e,t)=>O(r,typeof e!="symbol"?e+"":e,t);import{X as i}from"./misc-vendor-DzhHelBA.js";import{c as v,C as d}from"./crypto-vendor-CJzBceq2.js";const _="modulepreload",R=function(r){return"/"+r},T={},U=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){let c=function(l){return Promise.all(l.map(p=>Promise.resolve(p).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),u=a?.nonce||a?.getAttribute("nonce");s=c(t.map(l=>{if(l=R(l),l in T)return;T[l]=!0;const p=l.endsWith(".css"),f=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${f}`))return;const g=document.createElement("link");if(g.rel=p?"stylesheet":_,p||(g.as="script"),g.crossOrigin="",g.href=l,u&&g.setAttribute("nonce",u),document.head.appendChild(g),p)return new Promise((E,N)=>{g.addEventListener("load",E),g.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(c){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=c,window.dispatchEvent(a),!a.defaultPrevented)throw c}return s.then(c=>{for(const a of c||[])a.status==="rejected"&&o(a.reason);return e().catch(o)})},A="TableTech-2024-SecureKey-Default";var I=(r=>(r.NECESSARY="necessary",r.FUNCTIONAL="functional",r.ANALYTICS="analytics",r.MARKETING="marketing",r.PERFORMANCE="performance",r))(I||{});const S=[{name:"tabletech_session",category:"necessary",provider:"TableTech",purpose:"Maintains user session during website visit",duration:"Session",type:"first-party",encrypted:!0},{name:"csrf_token",category:"necessary",provider:"TableTech",purpose:"Protects against Cross-Site Request Forgery attacks",duration:"Session",type:"first-party",encrypted:!0},{name:"cookieconsent_status",category:"necessary",provider:"TableTech",purpose:"Stores cookie consent preferences",duration:"12 months",type:"first-party"},{name:"i18nextLng",category:"functional",provider:"TableTech",purpose:"Stores language preference (NL/EN)",duration:"12 months",type:"first-party"},{name:"timezone",category:"functional",provider:"TableTech",purpose:"Stores user timezone for correct time display",duration:"30 days",type:"first-party"},{name:"form_data_temp",category:"functional",provider:"TableTech",purpose:"Temporarily stores form data to prevent data loss",duration:"Session",type:"first-party",encrypted:!0},{name:"_ga",category:"analytics",provider:"Google Analytics",purpose:"Distinguishes unique users",duration:"2 years",type:"first-party"},{name:"_gid",category:"analytics",provider:"Google Analytics",purpose:"Distinguishes unique users",duration:"24 hours",type:"first-party"},{name:"_gat_gtag_*",category:"analytics",provider:"Google Analytics",purpose:"Throttles request rate",duration:"1 minute",type:"first-party"},{name:"_ga_*",category:"analytics",provider:"Google Analytics 4",purpose:"Stores session state and campaign info",duration:"2 years",type:"first-party"},{name:"_fbp",category:"marketing",provider:"Facebook/Meta",purpose:"Facebook Pixel for ad tracking",duration:"3 months",type:"third-party"},{name:"IDE",category:"marketing",provider:"Google/Doubleclick",purpose:"Google Ads remarketing",duration:"13 months",type:"third-party"},{name:"__cf_bm",category:"performance",provider:"Cloudflare",purpose:"Bot management and security",duration:"30 minutes",type:"first-party"}],y=class y{constructor(){m(this,"consent",null);m(this,"CONSENT_COOKIE","cookieconsent_status");m(this,"CONSENT_VERSION","1.0.0");m(this,"SECURE_FLAGS",{secure:!0,sameSite:"strict",expires:365});this.loadConsent(),this.initializeCSRF()}static getInstance(){return y.instance||(y.instance=new y),y.instance}initializeCSRF(){this.getCSRFToken()||this.generateCSRFToken()}generateCSRFToken(){const e=v.lib.WordArray.random(32).toString(),t=this.encrypt(e);return this.setCookie("csrf_token",t,{...this.SECURE_FLAGS,expires:void 0,sameSite:"strict"}),e}getCSRFToken(){const e=i.get("csrf_token");if(e)try{return this.decrypt(e)}catch{return null}return null}validateCSRFToken(e){const t=this.getCSRFToken();return t!==null&&t===e}encrypt(e){return v.AES.encrypt(e,A).toString()}decrypt(e){return v.AES.decrypt(e,A).toString(v.enc.Utf8)}loadConsent(){const e=i.get(this.CONSENT_COOKIE);if(e)try{this.consent=JSON.parse(e)}catch{this.consent=null}}saveConsent(e){this.consent={necessary:!0,functional:e.functional??!1,analytics:e.analytics??!1,marketing:e.marketing??!1,performance:e.performance??!1,timestamp:Date.now(),version:this.CONSENT_VERSION},i.set(this.CONSENT_COOKIE,JSON.stringify(this.consent),{...this.SECURE_FLAGS,expires:365}),this.applyConsent()}getConsent(){return this.consent}hasConsent(e){if(!this.consent)return e==="necessary";switch(e){case"necessary":return!0;case"functional":return this.consent.functional;case"analytics":return this.consent.analytics;case"marketing":return this.consent.marketing;case"performance":return this.consent.performance;default:return!1}}applyConsent(){const e=i.get();S.forEach(t=>{this.hasConsent(t.category)||Object.keys(e).forEach(n=>{(n===t.name||t.name.includes("*")&&new RegExp(t.name.replace("*",".*")).test(n))&&(i.remove(n),i.remove(n,{path:"/"}),i.remove(n,{domain:".tabletech.nl"}))})}),this.hasConsent("analytics")?this.enableGoogleAnalytics():this.disableGoogleAnalytics(),this.hasConsent("marketing")||this.disableMarketingScripts()}enableGoogleAnalytics(){typeof window<"u"&&window.gtag&&window.gtag("consent","update",{analytics_storage:"granted"})}disableGoogleAnalytics(){typeof window<"u"&&(window["ga-disable-G-GV8ZVCHNFE"]=!0,window.gtag&&window.gtag("consent","update",{analytics_storage:"denied"}),["_ga","_gid","_gat","_gat_gtag_UA"].forEach(e=>{i.remove(e),i.remove(e,{path:"/"}),i.remove(e,{domain:".tabletech.nl"})}))}disableMarketingScripts(){typeof window<"u"&&window.fbq&&(window.fbq=()=>{}),["_fbp","fr","IDE","test_cookie"].forEach(e=>{i.remove(e),i.remove(e,{path:"/"}),i.remove(e,{domain:".tabletech.nl"})})}setCookie(e,t,n,s){const o=S.find(a=>a.name===e);if(o&&!this.hasConsent(o.category)){console.warn(`Cannot set cookie ${e} - no consent for category ${o.category}`);return}const c=s||o?.encrypted?this.encrypt(t):t;i.set(e,c,{...this.SECURE_FLAGS,...n})}getCookie(e,t){const n=S.find(o=>o.name===e),s=i.get(e);if(s){if(t||n?.encrypted)try{return this.decrypt(s)}catch{return}return s}}removeCookie(e){i.remove(e),i.remove(e,{path:"/"}),i.remove(e,{domain:".tabletech.nl"})}clearAllCookies(e=!0){const t=i.get();Object.keys(t).forEach(n=>{const s=S.find(o=>o.name===n||o.name.includes("*")&&new RegExp(o.name.replace("*",".*")).test(n));(!e||!s||s.category!=="necessary")&&this.removeCookie(n)})}getCookiesByCategory(e){return S.filter(t=>t.category===e)}getAllCookieDefinitions(){return S}getActiveCookies(){return Object.keys(i.get())}generateSecureSession(){const e=v.lib.WordArray.random(32).toString(),t=this.encrypt(e);return this.setCookie("tabletech_session",t,{expires:void 0,sameSite:"strict",secure:!0}),e}validateSession(e){return this.getCookie("tabletech_session",!0)===e}updateConsentVersion(e){this.consent&&this.consent.version!==e&&(this.consent=null,this.removeCookie(this.CONSENT_COOKIE))}};m(y,"instance");let w=y;const b=w.getInstance(),h=class h{constructor(){m(this,"CSP_NONCE_LENGTH",16);this.initializeSecurityHeaders()}static getInstance(){return h.instance||(h.instance=new h),h.instance}initializeSecurityHeaders(){typeof window<"u"&&(this.setMetaTag("referrer","strict-origin-when-cross-origin"),this.ensureCSRFToken())}setMetaTag(e,t){let n=document.querySelector(`meta[name="${e}"]`);n||(n=document.createElement("meta"),n.name=e,document.head.appendChild(n)),n.content=t}generateNonce(){return d.lib.WordArray.random(this.CSP_NONCE_LENGTH).toString()}getCSPHeader(e){return["default-src 'self'",`script-src 'self' 'nonce-${e}' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com https://www.google-analytics.com https://challenges.cloudflare.com`,"style-src 'self' 'unsafe-inline'","img-src 'self' data: https: blob:","font-src 'self' data: https://r2cdn.perplexity.ai","connect-src 'self' https://www.google-analytics.com https://www.googletagmanager.com https://region1.google-analytics.com https://api.tabletech.nl https://tabletech.nl http://localhost:3002 ws://localhost:* wss://localhost:*","frame-src 'self' https://www.youtube.com https://player.vimeo.com https://challenges.cloudflare.com","base-uri 'self'","form-action 'self'","upgrade-insecure-requests","block-all-mixed-content"].join("; ")}sanitizeInput(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}validateEmail(e){return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e)&&e.length<=254}validatePhone(e){return/^(\+31|0031|0)[1-9][0-9]{8}$|^\+[1-9][0-9]{1,14}$/.test(e.replace(/[\s-]/g,""))}validateUrl(e){try{const t=new URL(e);return["http:","https:"].includes(t.protocol)}catch{return!1}}ensureCSRFToken(){let e=b.getCSRFToken();return e||(e=b.generateCSRFToken()),e}addCSRFToRequest(e){const t=this.ensureCSRFToken(),n=new Headers(e.headers||{});return n.set("X-CSRF-Token",t),{...e,headers:n,credentials:"same-origin"}}validateCSRFToken(e){return b.validateCSRFToken(e)}hashPassword(e,t){const n=t||d.lib.WordArray.random(16).toString(),s=d.PBKDF2(e,n,{keySize:256/32,iterations:1e4});return`${n}:${s.toString()}`}verifyPassword(e,t){const[n]=t.split(":");return this.hashPassword(e,n)===t}generateSecureRandomString(e=32){return d.lib.WordArray.random(e).toString()}encryptData(e,t){const n=JSON.stringify(e),s=t||void 0||"TableTech-Default-Key";return d.AES.encrypt(n,s).toString()}decryptData(e,t){try{const n=t||void 0||"TableTech-Default-Key",o=d.AES.decrypt(e,n).toString(d.enc.Utf8);return JSON.parse(o)}catch{return null}}rateLimit(e,t=5,n=900*1e3){const s=Date.now(),o=`rate_limit_${e}`,c=localStorage.getItem(o),a=c?JSON.parse(c):{attempts:[],blockedUntil:0};return a.blockedUntil>s?!1:(a.attempts=a.attempts.filter(u=>s-u<n),a.attempts.length>=t?(a.blockedUntil=s+n,localStorage.setItem(o,JSON.stringify(a)),!1):(a.attempts.push(s),localStorage.setItem(o,JSON.stringify(a)),!0))}clearRateLimit(e){localStorage.removeItem(`rate_limit_${e}`)}detectSuspiciousActivity(e){const t=[/<script[^>]*>.*?<\/script>/gi,/javascript:/gi,/on\w+\s*=/gi,/eval\(/gi,/document\.cookie/gi,/window\.location/gi,/<iframe/gi,/base64,/gi,/union.*select/gi,/drop.*table/gi,/insert.*into/gi,/select.*from/gi],n=JSON.stringify(e).toLowerCase();return t.some(s=>s.test(n))}sanitizeFormData(e){const t={};for(const[n,s]of Object.entries(e))typeof s=="string"?t[n]=this.sanitizeInput(s):typeof s=="object"&&s!==null&&!Array.isArray(s)?t[n]=this.sanitizeFormData(s):t[n]=s;return t}generateSessionToken(){const e=this.generateSecureRandomString(32),t=Date.now(),n=d.HmacSHA256(`${e}:${t}`,"TableTech-Session-Secret").toString();return`${e}:${t}:${n}`}validateSessionToken(e){try{const[t,n,s]=e.split(":"),o=d.HmacSHA256(`${t}:${n}`,"TableTech-Session-Secret").toString();if(s!==o)return!1;const c=parseInt(n),a=Date.now(),u=1440*60*1e3;return a-c<u}catch{return!1}}getSecurityHeaders(){const e=this.generateNonce();return{"Content-Security-Policy":this.getCSPHeader(e),"X-Content-Type-Options":"nosniff","X-Frame-Options":"DENY","X-XSS-Protection":"1; mode=block","Referrer-Policy":"strict-origin-when-cross-origin","Permissions-Policy":"geolocation=(), microphone=(), camera=()","Strict-Transport-Security":"max-age=31536000; includeSubDomains; preload","X-Permitted-Cross-Domain-Policies":"none","X-Download-Options":"noopen","X-DNS-Prefetch-Control":"off","CSP-Nonce":e}}logSecurityEvent(e,t){const n={type:e,timestamp:new Date().toISOString(),details:t,userAgent:navigator.userAgent,url:window.location.href},s=JSON.parse(localStorage.getItem("security_events")||"[]");s.push(n),s.length>100&&s.shift(),localStorage.setItem("security_events",JSON.stringify(s)),fetch("/api/security/log",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":this.ensureCSRFToken()},body:JSON.stringify(n)}).catch(()=>{})}};m(h,"instance");let C=h;const G=C.getInstance(),j=()=>{const r=sessionStorage.getItem("openCookieSettings")==="true";return r&&sessionStorage.removeItem("openCookieSettings"),r};function L(...r){return r.filter(Boolean).join(" ")}const D=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)}),k=()=>window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"http://localhost:3002/api":"https://tabletech.nl/api",H=async r=>{const e=k(),t=D(),n={restaurantName:r.restaurant||"Niet opgegeven",contactPerson:`${r.firstName} ${r.lastName}`.trim(),email:r.email,phone:r.phone,date:r.preferredDate,time:r.preferredTime,message:r.message||"Demo afspraak aangevraagd via website"};try{const s=await fetch(`${e}/v2/appointments`,{method:"POST",headers:{"Content-Type":"application/json","X-Idempotency-Key":t,"X-Client-Version":"2.0.0"},body:JSON.stringify(n)}),o=await s.json();return s.ok?{ok:o.success,requestId:o.referenceNumber||t,message:o.message||"Afspraak succesvol gemaakt"}:(console.warn("API error, but treating as success for demo:",o),{ok:!0,requestId:t,message:"Afspraak geregistreerd (demo mode)"})}catch(s){return console.warn("Network error, but treating as success for demo:",s),{ok:!0,requestId:t,message:"Afspraak geregistreerd (offline mode)"}}},K=async(r,e)=>{const t=k();try{const n=await fetch(`${t}/v2/appointments/available-dates?year=${r}&month=${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok){console.warn("API not available for available dates, using fallback");const o=new Date(r,e-1,0).getDate(),c=[];for(let a=1;a<=o;a++){const u=new Date(r,e-1,a),l=u.getDay();if(l===0||l===6)continue;const p=new Date;if(p.setHours(0,0,0,0),u<p)continue;const f=`${r}-${String(e).padStart(2,"0")}-${String(a).padStart(2,"0")}`;c.push(f)}return c}return(await n.json()).availableDates||[]}catch(n){return console.error("Error fetching available dates:",n),[]}},z=async r=>{const e=[{time:"09:00",isAvailable:!0},{time:"09:30",isAvailable:!0},{time:"10:00",isAvailable:!0},{time:"10:30",isAvailable:!0},{time:"11:00",isAvailable:!0},{time:"11:30",isAvailable:!0},{time:"13:00",isAvailable:!0},{time:"13:30",isAvailable:!0},{time:"14:00",isAvailable:!0},{time:"14:30",isAvailable:!0},{time:"15:00",isAvailable:!0},{time:"15:30",isAvailable:!0},{time:"16:00",isAvailable:!0},{time:"16:30",isAvailable:!0}],t=k();try{const n=await fetch(`${t}/v2/appointments/slots?date=${r}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)return console.warn("API not available, using default slots"),e;const s=await n.json();return s.success&&s.slots?s.slots:e}catch(n){return console.warn("Error fetching available slots, using defaults:",n),e}};export{I as C,U as _,j as a,L as b,b as c,z as d,H as e,K as g,G as s};
